!function(a){a.isScrollToFixed=function(b){return!!a(b).data("ScrollToFixed")},a.ScrollToFixed=function(b,c){function q(){f.trigger("preUnfixed.ScrollToFixed"),x(),f.trigger("unfixed.ScrollToFixed"),m=-1,j=f.offset().top,k=f.offset().left,d.options.offsets&&(k+=f.offset().left-f.position().left),l==-1&&(l=k),g=f.css("position"),e=!0,d.options.bottom!=-1&&(f.trigger("preFixed.ScrollToFixed"),v(),f.trigger("fixed.ScrollToFixed"))}function r(){var a=d.options.limit;return a?"function"==typeof a?a.apply(f):a:0}function s(){return"fixed"===g}function t(){return"absolute"===g}function u(){return!(s()||t())}function v(){s()||(n.css({display:f.css("display"),width:f.outerWidth(!0),height:f.outerHeight(!0),float:f.css("float")}),cssOptions={position:"fixed",top:d.options.bottom==-1?z():"",bottom:d.options.bottom==-1?"":d.options.bottom,"margin-left":"0px"},d.options.dontSetWidth||(cssOptions.width=f.width()),f.css(cssOptions),f.addClass("scroll-to-fixed-fixed"),d.options.className&&f.addClass(d.options.className),g="fixed")}function w(){var a=r(),b=k;d.options.removeOffsets&&(b=0,a-=j),cssOptions={position:"absolute",top:a,left:b,"margin-left":"0px",bottom:""},d.options.dontSetWidth||(cssOptions.width=f.width()),f.css(cssOptions),g="absolute"}function x(){u()||(m=-1,n.css("display","none"),f.css({width:"",position:h,left:"",top:i.top,"margin-left":""}),f.removeClass("scroll-to-fixed-fixed"),d.options.className&&f.removeClass(d.options.className),g=null)}function y(a){a!=m&&(f.css("left",k-a),m=a)}function z(){var a=d.options.marginTop;return a?"function"==typeof a?a.apply(f):a:0}function A(){if(a.isScrollToFixed(f)){var b=e;e||q();var c=a(window).scrollLeft(),g=a(window).scrollTop(),i=r();d.options.minWidth&&a(window).width()<d.options.minWidth?u()&&b||(C(),f.trigger("preUnfixed.ScrollToFixed"),x(),f.trigger("unfixed.ScrollToFixed")):d.options.bottom==-1?i>0&&g>=i-z()?t()&&b||(C(),f.trigger("preAbsolute.ScrollToFixed"),w(),f.trigger("unfixed.ScrollToFixed")):g>=j-z()?(s()&&b||(C(),f.trigger("preFixed.ScrollToFixed"),v(),m=-1,f.trigger("fixed.ScrollToFixed")),y(c)):u()&&b||(C(),f.trigger("preUnfixed.ScrollToFixed"),x(),f.trigger("unfixed.ScrollToFixed")):i>0?g+a(window).height()-f.outerHeight(!0)>=i-(z()||-B())?s()&&(C(),f.trigger("preUnfixed.ScrollToFixed"),"absolute"===h?w():x(),f.trigger("unfixed.ScrollToFixed")):(s()||(C(),f.trigger("preFixed.ScrollToFixed"),v()),y(c),f.trigger("fixed.ScrollToFixed")):y(c)}}function B(){return d.options.bottom?d.options.bottom:0}function C(){var a=f.css("position");"absolute"==a?f.trigger("postAbsolute.ScrollToFixed"):"fixed"==a?f.trigger("postFixed.ScrollToFixed"):f.trigger("postUnfixed.ScrollToFixed")}var d=this;d.$el=a(b),d.el=b,d.$el.data("ScrollToFixed",d);var g,h,i,e=!1,f=d.$el,j=0,k=0,l=-1,m=-1,n=null,D=function(a){f.is(":visible")&&(e=!1,A())},E=function(a){A()},G=function(a){a=a||window.event,a.preventDefault&&a.preventDefault(),a.returnValue=!1};d.init=function(){d.options=a.extend({},a.ScrollToFixed.defaultOptions,c),d.$el.css("z-index",d.options.zIndex),n=a("<div />"),g=f.css("position"),h=f.css("position"),i=a.extend({},f.offset()),u()&&d.$el.after(n),a(window).bind("resize.ScrollToFixed",D),a(window).bind("scroll.ScrollToFixed",E),d.options.preFixed&&f.bind("preFixed.ScrollToFixed",d.options.preFixed),d.options.postFixed&&f.bind("postFixed.ScrollToFixed",d.options.postFixed),d.options.preUnfixed&&f.bind("preUnfixed.ScrollToFixed",d.options.preUnfixed),d.options.postUnfixed&&f.bind("postUnfixed.ScrollToFixed",d.options.postUnfixed),d.options.preAbsolute&&f.bind("preAbsolute.ScrollToFixed",d.options.preAbsolute),d.options.postAbsolute&&f.bind("postAbsolute.ScrollToFixed",d.options.postAbsolute),d.options.fixed&&f.bind("fixed.ScrollToFixed",d.options.fixed),d.options.unfixed&&f.bind("unfixed.ScrollToFixed",d.options.unfixed),d.options.spacerClass&&n.addClass(d.options.spacerClass),f.bind("resize.ScrollToFixed",function(){n.height(f.height())}),f.bind("scroll.ScrollToFixed",function(){f.trigger("preUnfixed.ScrollToFixed"),x(),f.trigger("unfixed.ScrollToFixed"),A()}),f.bind("detach.ScrollToFixed",function(b){G(b),f.trigger("preUnfixed.ScrollToFixed"),x(),f.trigger("unfixed.ScrollToFixed"),a(window).unbind("resize.ScrollToFixed",D),a(window).unbind("scroll.ScrollToFixed",E),f.unbind(".ScrollToFixed"),d.$el.removeData("ScrollToFixed")}),D()},d.init()},a.ScrollToFixed.defaultOptions={marginTop:0,limit:0,bottom:-1,zIndex:1e3},a.fn.scrollToFixed=function(b){return this.each(function(){new a.ScrollToFixed(this,b)})}}(jQuery);